import asyncio
import os
from aiogram import Bot, Dispatcher
from aiogram.types import Message, ReplyKeyboardMarkup, KeyboardButton
from aiogram.filters import CommandStart
from dotenv import load_dotenv

from aiogram.fsm.state import State, StatesGroup
from aiogram.fsm.context import FSMContext
from aiogram.fsm.storage.memory import MemoryStorage

last_age_storage = {}

class SleepTest(StatesGroup):
    age = State()
    q2 = State()
    q3 = State()
    q4 = State()
    q5 = State()
    q6 = State()
    q7 = State()
    q8 = State()
    q9 = State()

load_dotenv()
BOT_TOKEN = os.getenv("BOT_TOKEN")

bot = Bot(token=BOT_TOKEN)
dp = Dispatcher(storage=MemoryStorage())

@dp.message(CommandStart())
async def start(message: Message, state: FSMContext):
    keyboard = ReplyKeyboardMarkup(
        keyboard=[
            [KeyboardButton(text="0‚Äì3 –º–µ—Å—è—Ü–∞")],
            [KeyboardButton(text="4‚Äì6 –º–µ—Å—è—Ü–µ–≤")],
            [KeyboardButton(text="7‚Äì9 –º–µ—Å—è—Ü–µ–≤")],
            [KeyboardButton(text="10‚Äì12 –º–µ—Å—è—Ü–µ–≤")],
            [KeyboardButton(text="13‚Äì18 –º–µ—Å—è—Ü–µ–≤")],
            [KeyboardButton(text="19‚Äì24 –º–µ—Å—è—Ü–∞")]
        ],
        resize_keyboard=True
    )

    await message.answer(
        "üìå –í–æ–ø—Ä–æ—Å 1.\n–£–∫–∞–∂–∏—Ç–µ –≤–æ–∑—Ä–∞—Å—Ç –≤–∞—à–µ–≥–æ —Ä–µ–±—ë–Ω–∫–∞:",
        reply_markup=keyboard
    )

    await state.set_state(SleepTest.age)


@dp.message(SleepTest.age)
async def process_age(message: Message, state: FSMContext):
    await state.update_data(age=message.text)
    last_age_storage [message.from_user.id] = message.text

    keyboard = ReplyKeyboardMarkup(
        keyboard=[
            [KeyboardButton(text="–î–∞")],
            [KeyboardButton(text="–ù–µ—Ç")],
            [KeyboardButton(text="–ù–µ –∑–Ω–∞—é")]
        ],
        resize_keyboard=True
    )

    await message.answer(
        "üìå –í–æ–ø—Ä–æ—Å 2.\n–í—ã—Å—ã–ø–∞–µ—Ç –ª–∏ —Ä–µ–±—ë–Ω–æ–∫ —Å–≤–æ—é –¥–Ω–µ–≤–Ω—É—é –Ω–æ—Ä–º—É?",
        reply_markup=keyboard
    )

    await state.set_state(SleepTest.q2)


@dp.message(SleepTest.q2)
async def process_q2(message: Message, state: FSMContext):
    if message.text == "–ù–µ –∑–Ω–∞—é":
        keyboard = ReplyKeyboardMarkup(
            keyboard=[
                [KeyboardButton(text="–î–∞")],
                [KeyboardButton(text="–ù–µ—Ç")],
                [KeyboardButton(text="–ù–µ –∑–Ω–∞—é")]
            ],
            resize_keyboard=True
        )

        await message.answer(
            SLEEP_TABLE,
            reply_markup=keyboard
        )
        return

    await state.update_data(q2=message.text)

    keyboard = ReplyKeyboardMarkup(
        keyboard=[
            [KeyboardButton(text="–î–∞")],
            [KeyboardButton(text="–ù–µ—Ç")],
            [KeyboardButton(text="–ù–µ –∑–Ω–∞—é")]
        ],
        resize_keyboard=True
    )

    await message.answer(
        "üìå –í–æ–ø—Ä–æ—Å 3.\n"
        "–í—ã—Å—ã–ø–∞–µ—Ç –ª–∏ —Ä–µ–±—ë–Ω–æ–∫ —Å–≤–æ—é –Ω–æ—á–Ω—É—é –Ω–æ—Ä–º—É —Å–Ω–∞?",
        reply_markup=keyboard
    )

    await state.set_state(SleepTest.q3)

@dp.message(SleepTest.q3)
async def process_q3(message: Message, state: FSMContext):
    if message.text == "–ù–µ –∑–Ω–∞—é":
        keyboard = ReplyKeyboardMarkup(
            keyboard=[
                [KeyboardButton(text="–î–∞")],
                [KeyboardButton(text="–ù–µ—Ç")],
                [KeyboardButton(text="–ù–µ –∑–Ω–∞—é")]
            ],
            resize_keyboard=True
        )

        await message.answer(
            SLEEP_TABLE,
            reply_markup=keyboard
        )
        return

    await state.update_data(q3=message.text)

    keyboard = ReplyKeyboardMarkup(
        keyboard=[
            [KeyboardButton(text="–î–∞")],
            [KeyboardButton(text="–ù–µ—Ç")],
            [KeyboardButton(text="–ù–µ –∑–Ω–∞—é")]
        ],
        resize_keyboard=True
    )

    await message.answer(
        "üìå –í–æ–ø—Ä–æ—Å 4.\n"
        "–í—ã–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ª–∏ —Ä–µ–±—ë–Ω–æ–∫ —Å–≤–æ—é –Ω–æ—Ä–º—É –≤—Ä–µ–º–µ–Ω–∏ –±–æ–¥—Ä—Å—Ç–≤–æ–≤–∞–Ω–∏—è?",
        reply_markup=keyboard
    )

    await state.set_state(SleepTest.q4)

@dp.message(SleepTest.q4)
async def process_q4(message: Message, state: FSMContext):
    if message.text == "–ù–µ –∑–Ω–∞—é":
        keyboard = ReplyKeyboardMarkup(
            keyboard=[
                [KeyboardButton(text="–î–∞")],
                [KeyboardButton(text="–ù–µ—Ç")],
                [KeyboardButton(text="–ù–µ –∑–Ω–∞—é")]
            ],
            resize_keyboard=True
        )

        await message.answer(
            SLEEP_TABLE,
            reply_markup=keyboard
        )
        return

    await state.update_data(q4=message.text)

    keyboard = ReplyKeyboardMarkup(
        keyboard=[
            [KeyboardButton(text="–î–∞")],
            [KeyboardButton(text="–ù–µ—Ç")],
            [KeyboardButton(text="–ù–µ –≤—Å–µ–≥–¥–∞")]
        ],
        resize_keyboard=True
    )

    await message.answer(
        "üìå –í–æ–ø—Ä–æ—Å 5.\n"
        "–õ–µ–≥–∫–æ –ª–∏ —Ä–µ–±—ë–Ω–æ–∫ –∑–∞—Å—ã–ø–∞–µ—Ç?\n"
        "–ù–æ—Ä–º–æ–π —Å—á–∏—Ç–∞–µ—Ç—Å—è –∑–∞—Å—ã–ø–∞–Ω–∏–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –Ω–µ –±–æ–ª–µ–µ 20 –º–∏–Ω—É—Ç —Å –Ω–∞—á–∞–ª–∞ –≤—Ä–µ–º–µ–Ω–∏ —É–∫–ª–∞–¥—ã–≤–∞–Ω–∏—è, –±–µ–∑ –ø–ª–∞—á–∞ –∏ —Ä–∞–∑–¥—Ä–∞–∂–µ–Ω–∏—è.",
        reply_markup=keyboard
    )

    await state.set_state(SleepTest.q5)

@dp.message(SleepTest.q5)
async def process_q5(message: Message, state: FSMContext):
    await state.update_data(q5=message.text)

    keyboard = ReplyKeyboardMarkup(
        keyboard=[
            [KeyboardButton(text="–†–µ–±–µ–Ω–æ–∫ —á–∞—â–µ —Å–ø–æ–∫–æ–π–Ω—ã–π, –≤ —Ö–æ—Ä–æ—à–µ–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–∏")],
            [KeyboardButton(text="–†–µ–±–µ–Ω–æ–∫ —á–∞—â–µ –∫–∞–ø—Ä–∏–∑–Ω–∏—á–∞–µ—Ç, –Ω–æ –±—ã—Å—Ç—Ä–æ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –∏ —É—Å–ø–æ–∫–∞–∏–≤–∞–µ—Ç—Å—è")],
            [KeyboardButton(text="–ú–∞–ª—ã—à —á–∞—Å—Ç–æ –ø–ª–∞—á–µ—Ç, —Ç—Ä–µ–±—É–µ—Ç –±–æ–ª—å—à–µ –≤–Ω–∏–º–∞–Ω–∏—è")],
            [KeyboardButton(text="–ú–∞–ª—ã—à —Ä–∞–∑–¥—Ä–∞–∂–∏—Ç–µ–ª—å–Ω—ã–π, –±–µ—Å–ø–æ–∫–æ–π–Ω—ã–π, –≤ –ø–ª–æ—Ö–æ–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–∏")]
        ],
        resize_keyboard=True
    )

    await message.answer(
        "üìå –í–æ–ø—Ä–æ—Å 6.\n"
        "–ü–æ–≤–µ–¥–µ–Ω–∏–µ —Ä–µ–±—ë–Ω–∫–∞ –ø–æ—Å–ª–µ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏—è:",
        reply_markup=keyboard
    )

    await state.set_state(SleepTest.q6)

@dp.message(SleepTest.q6)
async def process_q6(message: Message, state: FSMContext):
    await state.update_data(q6=message.text)

    keyboard = ReplyKeyboardMarkup(
        keyboard=[
            [KeyboardButton(text="–î–∞")],
            [KeyboardButton(text="–ù–µ—Ç")],
            [KeyboardButton(text="–†–µ–¥–∫–æ")]
        ],
        resize_keyboard=True
    )

    await message.answer(
        "üìå –í–æ–ø—Ä–æ—Å 7.\n"
        "–ï—Å—Ç—å –ª–∏ —É —Ä–µ–±—ë–Ω–∫–∞ –ø—Ä–∏–∑–Ω–∞–∫–∏ –±–æ–ª–µ–∑–Ω–∏, –∞–ø–Ω–æ—ç —Å–Ω–∞ –∏–ª–∏ —Ö—Ä–∞–ø–∞?",
        reply_markup=keyboard
    )

    await state.set_state(SleepTest.q7)

@dp.message(SleepTest.q7)
async def process_q7(message: Message, state: FSMContext):
    await state.update_data(q7=message.text)

    keyboard = ReplyKeyboardMarkup(
        keyboard=[
            [KeyboardButton(text="–î–∞")],
            [KeyboardButton(text="–ù–µ—Ç")]
        ],
        resize_keyboard=True
    )

    await message.answer(
        "üìå –í–æ–ø—Ä–æ—Å 8.\n"
        "–ï—Å—Ç—å –ª–∏ —É —Ä–µ–±—ë–Ω–∫–∞ –∫–æ—Ä–æ—Ç–∫–∏–µ –¥–Ω–µ–≤–Ω—ã–µ —Å–Ω—ã\n"
        "(–ö–æ—Ä–æ—Ç–∫–∏–º–∏ –¥–Ω–µ–≤–Ω—ã–º–∏ —Å–Ω–∞–º–∏ —Å—á–∏—Ç–∞–µ—Ç—Å—è —Å–æ–Ω –≤ –æ–¥–∏–Ω —Ü–∏–∫–ª, —Ç–æ –µ—Å—Ç—å –º–µ–Ω–µ–µ 40 –º–∏–Ω—É—Ç. –°–æ–Ω –ª–∏–±–æ –Ω–µ –ø—Ä–æ–¥–ª–µ–≤–∞–µ—Ç—Å—è, –ª–∏–±–æ –ø—Ä–æ–¥–ª–µ–≤–∞–µ—Ç—Å—è —Å —Ç—Ä—É–¥–æ–º)?",
        reply_markup=keyboard
    )

    await state.set_state(SleepTest.q8)

@dp.message(SleepTest.q8)
async def process_q8(message: Message, state: FSMContext):
    await state.update_data(q8=message.text)

    keyboard = ReplyKeyboardMarkup(
        keyboard=[
            [KeyboardButton(text="–î–∞")],
            [KeyboardButton(text="–ù–µ—Ç")]
        ],
        resize_keyboard=True
    )

    await message.answer(
        "üìå –í–æ–ø—Ä–æ—Å 9.\n"
        "–ü–æ—Å–µ—â–∞–µ—Ç –ª–∏ –≤–∞—à —Ä–µ–±—ë–Ω–æ–∫ –¥–µ—Ç—Å–∫–∏–π —Å–∞–¥?\n"
        "(–ø—Ä–æ—Ö–æ–¥–∏—Ç –ª–∏ –∞–¥–∞–ø—Ç–∞—Ü–∏—é)",
        reply_markup=keyboard
    )

    await state.set_state(SleepTest.q9)

@dp.message(SleepTest.q9)
async def process_q9(message: Message, state: FSMContext):
    await state.update_data(q9=message.text)

    data = await state.get_data()
    result = interpret_results(data)

    await message.answer(
        result,
        parse_mode="Markdown",
        reply_markup=AGE_BUTTON
    )
    await state.clear()

@dp.message(lambda message: message.text == "üìå –° —á–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–æ–∑—Ä–∞—Å—Ç–∞ —Ä–µ–±—ë–Ω–∫–∞")
async def show_age_recommendations(message: Message):
    user_age = last_age_storage.get(message.from_user.id)

    text = AGE_RECOMMENDATIONS.get(
        user_age,
        "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç—É –Ω–µ –Ω–∞–π–¥–µ–Ω—ã."
    )

    await message.answer(
        text,
        parse_mode="Markdown"
    )

AGE_BUTTON = ReplyKeyboardMarkup(
    keyboard=[
        [KeyboardButton(text="üìå –° —á–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–æ–∑—Ä–∞—Å—Ç–∞ —Ä–µ–±—ë–Ω–∫–∞")]
    ],
    resize_keyboard=True
)

AGE_RECOMMENDATIONS = {
    "0‚Äì3 –º–µ—Å—è—Ü–∞": (
        "üë∂ *–í–æ–∑—Ä–∞—Å—Ç 0‚Äì4 –º–µ—Å—è—Ü–∞*\n\n"
        "–ö–ª—é—á–µ–≤—ã–º–∏ —Ñ–∞–∫—Ç–æ—Ä–∞–º–∏ —Å–Ω–∞ –≤ —ç—Ç–æ–º –≤–æ–∑—Ä–∞—Å—Ç–µ —è–≤–ª—è–µ—Ç—Å—è:\n"
        "‚Ä¢ —É—Å–ª–æ–≤–∏—è —Å–Ω–∞ (—Ç–µ–º–Ω–æ—Ç–∞, —Ç–∏—à–∏–Ω–∞, —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞)\n"
        "‚Ä¢ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ —Ä–µ–±—ë–Ω–∫–∞\n"
        "‚Ä¢ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –Ω–µ–¥–æ—Å—ã–ø–∞ –∏ –ø–µ—Ä–µ–≤–æ–∑–±—É–∂–¥–µ–Ω–∏—è\n\n"
        "‚ùó –í —ç—Ç–æ–º –≤–æ–∑—Ä–∞—Å—Ç–µ —Å–æ–Ω –µ—â—ë –Ω–µ–∑—Ä–µ–ª—ã–π ‚Äî —ç—Ç–æ –Ω–æ—Ä–º–∞."
    ),
    "4‚Äì6 –º–µ—Å—è—Ü–µ–≤": (
        "üë∂ *–í–æ–∑—Ä–∞—Å—Ç 5‚Äì10 –º–µ—Å—è—Ü–µ–≤*\n\n"
        "–ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã —Å–Ω–∞:\n"
        "‚Ä¢ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ä–µ–∂–∏–º–∞ –±–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–º —Ä–∏—Ç–º–∞–º\n"
        "‚Ä¢ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–Ω–∞\n"
        "‚Ä¢ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–≤—ã—á–µ–∫ –Ω–∞ –∑–∞—Å—ã–ø–∞–Ω–∏–µ\n\n"
        "‚ú® –ò–º–µ–Ω–Ω–æ –≤ —ç—Ç–æ–º –≤–æ–∑—Ä–∞—Å—Ç–µ –ª—É—á—à–µ –≤—Å–µ–≥–æ –º—è–≥–∫–æ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–Ω."
    ),
    "7‚Äì9 –º–µ—Å—è—Ü–µ–≤": (
        "üë∂ *–í–æ–∑—Ä–∞—Å—Ç 5‚Äì10 –º–µ—Å—è—Ü–µ–≤*\n\n"
        "–§–æ–∫—É—Å:\n"
        "‚Ä¢ —Ä–µ–∂–∏–º —Å–Ω–∞ –∏ –±–æ–¥—Ä—Å—Ç–≤–æ–≤–∞–Ω–∏—è\n"
        "‚Ä¢ —Å—Ç–∞–±–∏–ª—å–Ω–æ–µ –≤—Ä–µ–º—è —É–∫–ª–∞–¥—ã–≤–∞–Ω–∏—è\n"
        "‚Ä¢ –∞—Å—Å–æ—Ü–∏–∞—Ü–∏–∏ –Ω–∞ –∑–∞—Å—ã–ø–∞–Ω–∏–µ"
    ),
    "10‚Äì12 –º–µ—Å—è—Ü–µ–≤": (
        "üë∂ *–í–æ–∑—Ä–∞—Å—Ç 5‚Äì10 –º–µ—Å—è—Ü–µ–≤*\n\n"
        "–§–æ–∫—É—Å:\n"
        "‚Ä¢ –ø–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —Å–Ω–∞–º–∏\n"
        "‚Ä¢ –∫–æ–Ω—Ç—Ä–æ–ª—å –ø–µ—Ä–µ–≤–æ–∑–±—É–∂–¥–µ–Ω–∏—è\n"
        "‚Ä¢ –ø—Ä–∏–≤—ã—á–∫–∏ –∑–∞—Å—ã–ø–∞–Ω–∏—è"
    ),
    "13‚Äì18 –º–µ—Å—è—Ü–µ–≤": (
        "üß∏ *–í–æ–∑—Ä–∞—Å—Ç 11 –º–µ—Å—è—Ü–µ–≤ ‚Äì 2 –≥–æ–¥–∞*\n\n"
        "–ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã —Å–Ω–∞:\n"
        "‚Ä¢ –ø—Ä–∏–≤—ã—á–∫–∏ –Ω–∞ –∑–∞—Å—ã–ø–∞–Ω–∏–µ\n"
        "‚Ä¢ –º–µ—Å—Ç–æ —Å–Ω–∞\n"
        "‚Ä¢ —Å–ø–æ—Å–æ–± –∑–∞—Å—ã–ø–∞–Ω–∏—è –∏ —Å–Ω–∞\n\n"
        "‚Ä¢ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–æ—Ü–µ—Å—Å –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ –≤ –¥–µ—Ç—Å–∫–æ–º —Å–∞–¥—É\n"
        "‚ö†Ô∏è –ß–∞—Å—Ç–æ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ —Å–≤—è–∑–∞–Ω—ã –Ω–µ —Å —Ä–µ–∂–∏–º–æ–º, –∞ —Å –ø—Ä–∏–≤—ã—á–∫–∞–º–∏."
    ),
    "19‚Äì24 –º–µ—Å—è—Ü–∞": (
        "üß∏ *–í–æ–∑—Ä–∞—Å—Ç 11 –º–µ—Å—è—Ü–µ–≤ ‚Äì 2 –≥–æ–¥–∞*\n\n"
        "–§–æ–∫—É—Å:\n"
        "‚Ä¢ –≥—Ä–∞–Ω–∏—Ü—ã –∏ —Ä–∏—Ç—É–∞–ª—ã —Å–Ω–∞\n"
        "‚Ä¢ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–æ—Ü–µ—Å—Å –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ –≤ –¥–µ—Ç—Å–∫–æ–º —Å–∞–¥—É\n"
        "‚Ä¢ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–µ –∑–∞—Å—ã–ø–∞–Ω–∏–µ\n"
        "‚Ä¢ —Å—Ç–∞–±–∏–ª—å–Ω—ã–π —Ä–µ–∂–∏–º –¥–Ω—è"
    ),
}

SLEEP_TABLE = (
    "üìä –ù–æ—Ä–º—ã —Å–Ω–∞ –∏ –±–æ–¥—Ä—Å—Ç–≤–æ–≤–∞–Ω–∏—è:\n\n"
    "üü¢ 0‚Äì3 –º–µ—Å ‚Äî –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–æ—á–Ω–æ–≥–æ —Å–Ω–∞: 9-11 —á–∞—Å–æ–≤; –¥–Ω–µ–≤–Ω–æ–≥–æ —Å–Ω–∞: 5-7 —á–∞—Å–æ–≤, –æ–±—â–µ–µ –≤—Ä–µ–º—è —Å–Ω–∞: 14‚Äì18 —á–∞—Å–æ–≤. –í—Ä–µ–º—è –±–æ–¥—Ä—Å—Ç–≤–æ–≤–∞–Ω–∏—è –º–µ–∂–¥—É —Å–Ω–∞–º–∏: 1 - 1:35 —á–∞—Å–∞\n"
    "üü¢ 4‚Äì6 –º–µ—Å ‚Äî –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–æ—á–Ω–æ–≥–æ —Å–Ω–∞: 10-12 —á–∞—Å–æ–≤; –¥–Ω–µ–≤–Ω–æ–≥–æ —Å–Ω–∞: 3-5 —á–∞—Å–æ–≤, –æ–±—â–µ–µ –≤—Ä–µ–º—è —Å–Ω–∞: 13-17 —á–∞—Å–æ–≤. –í—Ä–µ–º—è –±–æ–¥—Ä—Å—Ç–≤–æ–≤–∞–Ω–∏—è –º–µ–∂–¥—É —Å–Ω–∞–º–∏: 1:45-2:30 —á–∞—Å–∞\n"
    "üü¢ 7‚Äì9 –º–µ—Å ‚Äî –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–æ—á–Ω–æ–≥–æ —Å–Ω–∞: 10-12 —á–∞—Å–æ–≤; –¥–Ω–µ–≤–Ω–æ–≥–æ —Å–Ω–∞: 2:30-3 —á–∞—Å–∞, –æ–±—â–µ–µ –≤—Ä–µ–º—è —Å–Ω–∞: 12:30-15 —á–∞—Å–æ–≤. –í—Ä–µ–º—è –±–æ–¥—Ä—Å—Ç–≤–æ–≤–∞–Ω–∏—è –º–µ–∂–¥—É —Å–Ω–∞–º–∏: 2:45-3:45 —á–∞—Å–∞\n"
    "üü¢ 10‚Äì12 –º–µ—Å ‚Äî –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–æ—á–Ω–æ–≥–æ —Å–Ω–∞: 10-12 —á–∞—Å–æ–≤; –¥–Ω–µ–≤–Ω–æ–≥–æ —Å–Ω–∞: 2-3 —á–∞—Å–∞, –æ–±—â–µ–µ –≤—Ä–µ–º—è —Å–Ω–∞: 12-15 —á–∞—Å–æ–≤. –í—Ä–µ–º—è –±–æ–¥—Ä—Å—Ç–≤–æ–≤–∞–Ω–∏—è –º–µ–∂–¥—É —Å–Ω–∞–º–∏: 3-4:30 —á–∞—Å–∞\n"
    "üü¢ 13‚Äì18 –º–µ—Å ‚Äî –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–æ—á–Ω–æ–≥–æ —Å–Ω–∞: 10-12 —á–∞—Å–æ–≤; –¥–Ω–µ–≤–Ω–æ–≥–æ —Å–Ω–∞: 1:30-2:30 —á–∞—Å–∞, –æ–±—â–µ–µ –≤—Ä–µ–º—è —Å–Ω–∞: 11:30-14 —á–∞—Å–æ–≤. –í—Ä–µ–º—è –±–æ–¥—Ä—Å—Ç–≤–æ–≤–∞–Ω–∏—è –º–µ–∂–¥—É —Å–Ω–∞–º–∏: 3-5 —á–∞—Å–æ–≤"
    "üü¢ 19‚Äì24 –º–µ—Å ‚Äî –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–æ—á–Ω–æ–≥–æ —Å–Ω–∞: 10-12 —á–∞—Å–æ–≤; –¥–Ω–µ–≤–Ω–æ–≥–æ —Å–Ω–∞: 1:30-2:30 —á–∞—Å–æ–≤, –æ–±—â–µ–µ –≤—Ä–µ–º—è —Å–Ω–∞: 11-14 —á–∞—Å–æ–≤. –í—Ä–µ–º—è –±–æ–¥—Ä—Å—Ç–≤–æ–≤–∞–Ω–∏—è –º–µ–∂–¥—É —Å–Ω–∞–º–∏: 5-6 —á–∞—Å–æ–≤\n\n"
    "–í–∞–∂–Ω–æ! –í—Ä–µ–º—è —Å–Ω–∞ –∏ –±–æ–¥—Ä—Å—Ç–≤–æ–≤–∞–Ω–∏—è –º–æ–≥—É—Ç –±—ã—Ç—å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã –∏ –º–µ–Ω—è—Ç—å—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥–Ω–µ–≤–Ω—ã—Ö —Å–Ω–æ–≤! –ú—ã –æ–ø–∏—Ä–∞–µ–º—Å—è –Ω–∞ –æ–±—â–µ–ø—Ä–∏–Ω—è—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ!\n\n"
    "–ü–æ—Å–ª–µ –æ–∑–Ω–∞–∫–æ–º–ª–µ–Ω–∏—è –≤—ã–±–µ—Ä–∏—Ç–µ –æ—Ç–≤–µ—Ç –µ—â—ë —Ä–∞–∑ üëá"
)

def interpret_results(data: dict) -> str:
    red_flags = data.get("q7") in ["–î–∞", "–ò–Ω–æ–≥–¥–∞"]

    no_count = 0
    for key in ["q2", "q3", "q4"]:
        if data.get(key) == "–ù–µ—Ç":
            no_count += 1

    falling_asleep_problem = data.get("q5") in ["–ù–µ—Ç", "–ù–µ –≤—Å–µ–≥–¥–∞"]
    short_naps = data.get("q8") == "–î–∞"
    bad_mood = data.get("q6") in [
        "–ú–∞–ª—ã—à —á–∞—Å—Ç–æ –ø–ª–∞—á–µ—Ç, —Ç—Ä–µ–±—É–µ—Ç –±–æ–ª—å—à–µ –≤–Ω–∏–º–∞–Ω–∏—è",
        "–ú–∞–ª—ã—à —Ä–∞–∑–¥—Ä–∞–∂–∏—Ç–µ–ª—å–Ω—ã–π, –±–µ—Å–ø–æ–∫–æ–π–Ω—ã–π, –≤ –ø–ª–æ—Ö–æ–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–∏"
    ]

    # 1. –ù–æ—Ä–º–∞ —Å–Ω–∞
    if (
        no_count == 0
        and not falling_asleep_problem
        and not bad_mood
        and not short_naps
    ):
        return (
            "‚úÖ *–ù–æ—Ä–º–∞ —Å–Ω–∞*\n\n"
            "–°–æ–Ω —Ä–µ–±—ë–Ω–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –≤–æ–∑—Ä–∞—Å—Ç–Ω–æ–π –Ω–æ—Ä–º–µ:\n"
            "‚Ä¢ –†–µ–∂–∏–º –≤—ã—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ\n"
            "‚Ä¢ –ó–∞—Å—ã–ø–∞–Ω–∏–µ —Å–ø–æ–∫–æ–π–Ω–æ–µ, –±—ã—Å—Ç—Ä–æ–µ\n"
            "‚Ä¢ –ü—Ä–æ–±—É–∂–¥–µ–Ω–∏–µ –≤ —Ö–æ—Ä–æ—à–µ–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–∏\n\n"
            "–ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ —Å–æ–±–ª—é–¥–∞—Ç—å —Ä–µ–∂–∏–º –∏ —Ä–∏—Ç—É–∞–ª—ã —Å–Ω–∞ üíõ"
        )

    # 2. –õ—ë–≥–∫–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è
    if no_count <= 1:
        return (
            "üü° *–õ—ë–≥–∫–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è —Å–Ω–∞*\n\n"
            "–ï—Å—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å:\n"
            "‚Ä¢ —Ä–µ–∂–∏–º —Å–Ω–∞ –∏ –±–æ–¥—Ä—Å—Ç–≤–æ–≤–∞–Ω–∏—è\n"
            "‚Ä¢ —Ä–∏—Ç—É–∞–ª—ã –ø–µ—Ä–µ–¥ —Å–Ω–æ–º\n"
            "‚Ä¢ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–Ω–µ–≤–Ω–æ–≥–æ —Å–Ω–∞\n\n"
            "‚ú® –í –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–≤ —Ö–æ—Ä–æ—à–æ –ø–æ–¥–¥–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏."
        )

    # 3. –í—ã—Ä–∞–∂–µ–Ω–Ω—ã–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è
    return (
        "üî¥ *–í—ã—Ä–∞–∂–µ–Ω–Ω—ã–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è —Å–Ω–∞*\n\n"
        "–ù–∞–±–ª—é–¥–∞—é—Ç—Å—è —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:\n"
        "‚Ä¢ –º–æ–≥—É—Ç –±—ã—Ç—å –ø—Ä–∏–∑–Ω–∞–∫–∏ –ø–µ—Ä–µ–≤–æ–∑–±—É–∂–¥–µ–Ω–∏—è –∏–ª–∏ –Ω–µ–¥–æ—Å—ã–ø–∞\n"
        "‚Ä¢ –∑–∞—Å—ã–ø–∞–µ—Ç —Å —Ç—Ä—É–¥–æ–º\n"
        "‚Ä¢ —á–∞—Å—Ç–æ –∫–∞–ø—Ä–∏–∑–Ω–∏—á–∞–µ—Ç –ø–æ—Å–ª–µ —Å–Ω–∞\n\n"
        "üë©‚Äç‚öïÔ∏è –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∂–∏–º, –º–µ—Å—Ç–æ –∏ —É—Å–ª–æ–≤–∏—è —Å–Ω–∞ —Ä–µ–±–µ–Ω–∫–∞. –ü–æ—Å–ª–µ –±–∞–∑–æ–≤–æ–π –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏, –µ—Å–ª–∏ –Ω–µ –Ω–∞—Å—Ç—É–ø–∞—é—Ç —É–ª—É—á—à–µ–Ω–∏—è - —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞ –ø–æ –¥–µ—Ç—Å–∫–æ–º—É —Å–Ω—É."
    )

# 4. –¢—Ä–µ–≤–æ–∂–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã
    if red_flags:
        return (
            "üö® *–¢—Ä–µ–≤–æ–∂–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã*\n\n"
            "–ï—Å—Ç—å –ø—Ä–∏–∑–Ω–∞–∫–∏ –±–æ–ª–µ–∑–Ω–∏, –∞–ø–Ω–æ—ç —Å–Ω–∞ –∏–ª–∏ –≤—ã—Ä–∞–∂–µ–Ω–Ω–æ–≥–æ –Ω–µ–¥–æ—Å—ã–ø–∞.\n\n"
            "‚ö†Ô∏è –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫–∞–∫ –º–æ–∂–Ω–æ —Å–∫–æ—Ä–µ–µ –ø–æ–∫–∞–∑–∞—Ç—å —Ä–µ–±—ë–Ω–∫–∞ –≤—Ä–∞—á—É "
            "–¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è —Å–µ—Ä—å—ë–∑–Ω—ã—Ö –Ω–∞—Ä—É—à–µ–Ω–∏–π —Å–Ω–∞ –∏–ª–∏ –¥—ã—Ö–∞–Ω–∏—è. –ï—Å–ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–¥–æ—Ä–æ–≤—å—è —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ–µ, —Ç–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º –≤–∞–º –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—É –ø–æ –¥–µ—Ç—Å–∫–æ–º—É —Å–Ω—É!"
        )

async def main():
    await dp.start_polling(bot)


if __name__ == "__main__":
    asyncio.run(main())